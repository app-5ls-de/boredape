<!DOCTYPE html>
<html>
  <head>
    <title>Bored Ape</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      img#ape {
        position: fixed;
        left: 50%;
        bottom: 0;
        transform: translateX(-50%);
        margin: 0 auto;
        max-width: 100vw;
      }
    </style>
  </head>

  <body>
    <img id="ape" src="" />

    <img id="preload" style="display: none" />

    <script>
      let base =
        "https://cdn.jsdelivr.net/gh/PatrickHaussmann/boredape@v1.0.0/data/";
      let img = document.getElementById("ape");
      let max = 10000;

      const rand = () => Math.floor(Math.random() * max);

      async function set_color(url) {
        const response = await fetch(url);
        if (!response.ok) throw new Error(response.status);
        const data = await response.json();
        document.body.style.backgroundColor = data.color;
      }

      const load_img = (src) =>
        new Promise((resolve, reject) => {
          img.onload = resolve;
          img.onerror = reject;
          img.src = src;
        });

      function ape(n) {
        set_color(base + n + ".json");
        load_img(base + n + ".png");
      }

      let n = rand();
      let option = location.search ? location.search : location.hash;
      if (option) {
        if (option.substring(1) == "play")
          setInterval(() => {
            ape(rand());
          }, 2000);
        let num = Number(option.substring(1));
        if (Number.isInteger(num) && num < max) n = num;
      }

      ape(n);
    </script>
  </body>
</html>
